FROM maven:3-jdk-11 AS build

WORKDIR /app

COPY . .

# Prereq
RUN apt-get update
RUN apt-get -y install -y unzip xvfb libxi6 libgconf-2-4

# Install Chrome
RUN wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
RUN apt -y install ./google-chrome-stable_current_amd64.deb

# export variables
ENV MAVEN_OPTS="-Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -Dmaven.color=false -XX:+PerfDisableSharedMem -XX:-UsePerfData -XX:TieredStopAtLevel=1 -noverify -Djava.awt.headless=true -Dlog4j2.disable.jmx=true" \
    SPRING_PROFILES_ACTIVE=ci

RUN mvn test


